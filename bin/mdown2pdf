#!/usr/bin/env ruby
$-w = true

#depends on wkpdf gems
#sudo gem install wkpdf


#depends on rdiscount
begin
    require 'rubygems'
    require 'rdiscount'
rescue LoadError
    puts "Please install rdiscount as a gem"
end

TMP_FILE ='/tmp/markdown.html'

HTML_TEMPLATE_PREFIX=<<EOF
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
</head>
<body>
EOF

HTML_TEMPLATE_SUFFIX=<<EOF
</body>
</html>
EOF

if ARGV[1] && File.exists?(ARGV[0])
  #create a html file (need .html extension)
  File.open(TMP_FILE, 'w') do |w|
    w.write HTML_TEMPLATE_PREFIX
    open(ARGV[0]) do |r|
        w.write RDiscount.new(r.read).to_html
    end
    w.write HTML_TEMPLATE_SUFFIX
  end

  system("wkpdf --source #{TMP_FILE} --format A4 --output #{ARGV[1]}")
  system("open", ARGV[1])
else
  puts "Please use: mdown2pdf input_file output_file"
  exit(1)
end
